<ul class="nav navbar-nav navbar-right">
  <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
      <span class="user">{{user}}</span> <span class="caret"></span></a>
    <ul class="dropdown-menu">
      <li><input class="form-control" placeholder="英文或拼音昵称" onchange="changeNickname(this.value)"></li>
      <li role="separator" class="divider"></li>
      <li><a href="/{{pos}}/me">我校对的页</a></li>
      <li><a href="/ranking">校对排行榜</a></li>
    </ul>
  </li>
</ul>
<script>
  function changeNickname(name) {
    name = name.replace(/[^\w_]/g, '');
    if (name && name.length > 0) {
      $('.user').text(name);
      $.cookie('cut-user', name);
      localStorage.setItem('cut-user', name);
    }
  }
  var oldUser = localStorage.getItem('cut-user');
  {% if not user or user == '匿名' %}
  if (oldUser.length) {
    changeNickname(oldUser);
  }
  {% else %}
  localStorage.setItem('cut-user', '{{user}}');
  {% end %}
</script>